<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Exemplo CRUD com localStorage em JavaScript</title>
</head>
<body>
	<h1>Exemplo CRUD com localStorage em JavaScript</h1>

	<form id="form">
		<label for="nome">Nome:</label>
		<input type="text" id="nome" name="nome"><br><br>

		<label for="email">E-mail:</label>
		<input type="email" id="email" name="email"><br><br>

		<label for="telefone">Telefone:</label>
		<input type="tel" id="telefone" name="telefone"><br><br>

		<label for="endereco">Endereço:</label>
		<textarea id="endereco" name="endereco"></textarea><br><br>

		<button type="submit" id="btnSalvar">Adicionar</button>
		<button type="button" id="btnAtualizar" style="display:none;">Atualizar</button>
	</form>

	<table id="tabela">
		<thead>
			<tr>
				<th>Nome</th>
				<th>E-mail</th>
				<th>Telefone</th>
				<th>Endereço</th>
				<th>Ação</th>
			</tr>
		</thead>
		<tbody></tbody>
	</table>

	<script>
		// verifica se o localStorage é suportado pelo navegador
		if (typeof(Storage) === 'undefined') {
			alert('Desculpe, seu navegador não suporta Web Storage. Por favor, atualize para uma versão mais recente.');
		}

		// função para adicionar um novo item no localStorage
		function adicionarItem(nome, email, telefone, endereco) {
			let itens = JSON.parse(localStorage.getItem('itens')) || [];

			let item = {
				nome: nome,
				email: email,
				telefone: telefone,
				endereco: endereco
			};

			itens.push(item);
			localStorage.setItem('itens', JSON.stringify(itens));
		}

		// função para exibir os itens do localStorage na tabela
		function exibirItens() {
			let tbody = document.querySelector('#tabela tbody');
			tbody.innerHTML = '';

			let itens = JSON.parse(localStorage.getItem('itens')) || [];

			for (let index = 0; index < itens.length; index++) {
				let item = itens[index];

				let tr = document.createElement('tr');

				let tdNome = document.createElement('td');
				tdNome.textContent = item.nome;
				tr.appendChild(tdNome);

				let tdEmail = document.createElement('td');
				tdEmail.textContent = item.email;
				tr.appendChild(tdEmail);

				let tdTelefone = document.createElement('td');
				tdTelefone.textContent = item.telefone;
				tr.appendChild(tdTelefone);

				let tdEndereco = document.createElement('td');
				tdEndereco.textContent = item.endereco;
				tr.appendChild(tdEndereco);

				// cria um botão "Editar" e adiciona na linha da tabela
				let tdAcao = document.createElement('td');
				let btnEditar = document.createElement('button');
				btnEditar.textContent = 'Editar';
				btnEditar.addEventListener('click', function () {
					document.querySelector('#nome').value = item.nome;
					document.querySelector('#email').value = item.email;
					document.querySelector('#telefone').value = item.telefone;
				
				document.querySelector('#endereco').value = item.endereco;

				document.querySelector('#btnSalvar').style.display = 'none';
				document.querySelector('#btnAtualizar').style.display = 'block';

				// adiciona um atributo "data-index" ao botão "Atualizar" para identificar qual item deve ser atualizado
				document.querySelector('#btnAtualizar').setAttribute('data-index', index);
			});
			tdAcao.appendChild(btnEditar);

			// cria um botão "Excluir" e adiciona na linha da tabela
			let btnExcluir = document.createElement('button');
			btnExcluir.textContent = 'Excluir';
			btnExcluir.addEventListener('click', function () {
				if (confirm('Tem certeza que deseja excluir este item?')) {
					itens.splice(index, 1);
					localStorage.setItem('itens', JSON.stringify(itens));
					exibirItens();
				}
			});
			tdAcao.appendChild(btnExcluir);

			tr.appendChild(tdAcao);
			tbody.appendChild(tr);
		}
	}

	// evento submit do formulário
	document.querySelector('#form').addEventListener('submit', function (event) {
		event.preventDefault();

		let nome = document.querySelector('#nome').value;
		let email = document.querySelector('#email').value;
		let telefone = document.querySelector('#telefone').value;
		let endereco = document.querySelector('#endereco').value;

		// verifica se algum campo do formulário está vazio
		if (nome.trim() === '' || email.trim() === '' || telefone.trim() === '' || endereco.trim() === '') {
			alert('Por favor, preencha todos os campos.');
			return;
		}

		let index = document.querySelector('#btnAtualizar').getAttribute('data-index');

		if (index) {
			// se o atributo "data-index" existe no botão "Atualizar", significa que o usuário está editando um item existente

			let itens = JSON.parse(localStorage.getItem('itens')) || [];

			let item = {
				nome: nome,
				email: email,
				telefone: telefone,
				endereco: endereco
			};

			itens[index] = item;
			localStorage.setItem('itens', JSON.stringify(itens));

			document.querySelector('#btnSalvar').style.display = 'block';
			document.querySelector('#btnAtualizar').style.display = 'none';

			document.querySelector('#form').reset();

			exibirItens();
		} else {
			// caso contrário, significa que o usuário está adicionando um novo item

			adicionarItem(nome, email, telefone, endereco);

			document.querySelector('#form').reset();

			exibirItens();
		}
	});

	// evento click do botão "Atualizar"
	document.querySelector('#btnAtualizar').addEventListener('click', function () {
		let index = document.querySelector('#btnAtualizar').getAttribute('data-index');

		if (index) {
			// se o atributo "data-index" existe no botão "Atualizar", significa que o usuário está editando um item existente

			let itens = JSON.parse(localStorage.getItem('itens')) || [];

			let item = {
				nome: document.querySelector('#nome').value,
				email: document.querySelector('#email').value,
				telefone: document.querySelector('#telefone').value,
				endereco: document.querySelector('#endereco').value
			};

			itens[index] = item;
			localStorage.setItem('itens', JSON.stringify(itens));

			document.querySelector('#btnSalvar').style.display = 'block';
			document.querySelector('#btnAtualizar').style.display = 'none';

		
			document.querySelector('#form').reset();

			exibirItens();
		}
	});

	// evento click do botão "Cancelar"
	document.querySelector('#btnCancelar').addEventListener('click', function () {
		document.querySelector('#form').reset();

		document.querySelector('#btnSalvar').style.display = 'block';
		document.querySelector('#btnAtualizar').style.display = 'none';
	});

	// exibe os itens ao carregar a página
	exibirItens();
</script>
</body>
</html>